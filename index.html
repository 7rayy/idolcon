<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Voting Idol Live</title>
    <!-- Tailwind CSS untuk styling cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mencegah seleksi teks saat menahan tombol di HP */
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Animasi kustom */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        .btn-click:active {
            animation: pop 0.1s ease-in-out;
        }
        
        /* Kustomisasi Scrollbar agar terlihat manis */
        .custom-scroll::-webkit-scrollbar {
            width: 10px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #ec4899; /* Pink-500 */
            border-radius: 5px;
            border: 2px solid #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #db2777; /* Pink-600 */
        }
        
        /* Transisi Tab */
        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
            animation: fadeIn 0.3s ease-in-out;
        }
        .tab-content.active {
            display: flex; 
            flex-direction: column;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- PERBAIKAN HOVER DI HP --- */
        /* Animasi hover hanya aktif jika device punya mouse (pointer halus) */
        @media (hover: hover) {
            .card-hover:hover {
                transform: translateY(-0.25rem); /* Efek naik dikit */
                box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); /* Efek bayangan (shadow-xl) */
            }
            .group:hover .img-hover {
                transform: scale(1.05); /* Efek zoom gambar */
            }
            .group:hover .overlay-hover {
                opacity: 1; /* Efek gelap muncul */
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-purple-100 to-pink-100 h-screen w-screen text-gray-800 font-sans overflow-hidden flex flex-col select-none">

    <!-- Header (Full Width) -->
    <header class="bg-white shadow-md z-10 flex-none w-full">
        <div class="w-full px-6 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-r from-pink-500 to-purple-500 w-10 h-10 rounded-full flex items-center justify-center text-white text-base">
                    <i class="fa-solid fa-microphone-lines"></i>
                </div>
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-600 to-purple-600 hidden sm:block">
                    IdolCon Vote
                </h1>
            </div>
            
            <!-- Navigasi Tab -->
            <div class="flex bg-gray-100 p-1 rounded-lg">
                <button onclick="switchTab('voting')" id="btn-tab-voting" class="px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 bg-white shadow text-pink-600">
                    <i class="fa-solid fa-check-to-slot mr-2"></i>Vote
                </button>
                <button onclick="switchTab('admin')" id="btn-tab-admin" class="px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 text-gray-500 hover:text-gray-700">
                    <i class="fa-solid fa-chart-pie mr-2"></i>Hasil
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Area (Full Width & Height) -->
    <main class="flex-grow w-full px-6 py-4 overflow-hidden flex flex-col relative">

        <!-- TAB 1: VOTING AREA -->
        <div id="tab-voting" class="tab-content active">
            <div class="text-center mb-4 flex-none">
                <h2 class="text-3xl font-bold text-gray-800 mb-1">Pilih Idol Favorit mu!</h2>
                <p class="text-sm text-gray-500">Tahan tombol <strong>1 detik</strong> untuk memberikan suara.</p>
            </div>

            <!-- Scrollable Container -->
            <div class="flex-grow overflow-y-auto custom-scroll pb-10 pr-1">
                <!-- Grid Full Width: Menggunakan grid yang lebih responsif untuk layar lebar -->
                <div id="idol-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 xl:gap-6">
                    <!-- Kartu Idol akan digenerate oleh JS di sini -->
                </div>
            </div>
        </div>

        <!-- TAB 2: ADMIN & HASIL -->
        <div id="tab-admin" class="tab-content">
            <div class="flex justify-between items-end mb-6 border-b pb-4 flex-none">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Dashboard Suara</h2>
                    <p class="text-sm text-gray-500">Pantau hasil real-time.</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg shadow transition btn-click flex items-center text-sm">
                        <i class="fa-solid fa-file-excel mr-2"></i> Export
                    </button>
                    <button onclick="resetData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow transition btn-click flex items-center text-sm">
                        <i class="fa-solid fa-trash-can mr-2"></i> Reset
                    </button>
                </div>
            </div>

            <!-- Leaderboard Area -->
            <div class="flex-grow overflow-y-auto custom-scroll pr-2 bg-white rounded-xl shadow-sm border border-gray-100">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th class="p-4 border-b font-semibold text-gray-600 w-16 text-center">#</th>
                            <th class="p-4 border-b font-semibold text-gray-600">Idol</th>
                            <th class="p-4 border-b font-semibold text-gray-600 text-right">Suara</th>
                            <th class="p-4 border-b font-semibold text-gray-600 text-right w-32 hidden sm:table-cell">%</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Baris tabel digenerate JS -->
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur text-white px-8 py-4 rounded-full shadow-2xl flex items-center gap-4 transition-all duration-300 opacity-0 translate-y-10 pointer-events-none z-50">
        <i class="fa-solid fa-check-circle text-green-400 text-2xl"></i>
        <div class="flex flex-col">
            <span class="font-bold text-lg">Voting Berhasil!</span>
            <span id="toast-message" class="text-gray-300 text-sm">Suara telah direkam.</span>
        </div>
    </div>

    <script>
        // --- DATA IDOL ---
        const defaultIdols = [
            { id: 1, name: 'Hanabi', image: 'img/hanabi.jpg' },
            { id: 2, name: 'Caravelle', image: 'img/caravelle.jpg' },
            { id: 3, name: 'Tsuyosa', image: 'img/tsuyosa.jpg' },
            { id: 4, name: 'Mitsukare', image: 'img/mitsukare.jpg' },
            { id: 5, name: 'Nomisu', image: 'img/nomisu.jpg' },
            { id: 6, name: 'Nonamisty', image: 'img/nonamisty.jpg' },
            { id: 7, name: 'Saiki', image: 'img/saiki.jpg' },
            { id: 8, name: 'Triple-O', image: 'img/triple-o.jpg' },
            { id: 9, name: 'Effulgent Generation', image: 'img/eg.jpg' },
            { id: 10, name: 'Refresh Breeze', image: 'img/rb.jpg' }
        ];

        let idols = [];
        let pressTimer;
        let isHolding = false;

        // --- CORE FUNCTIONS ---

        function initData() {
            const storedData = localStorage.getItem('idolVoteData');
            
            if (storedData) {
                let parsedData = JSON.parse(storedData);
                idols = defaultIdols.map(defIdol => {
                    const existingData = parsedData.find(p => p.id === defIdol.id);
                    return {
                        ...defIdol,
                        votes: existingData ? existingData.votes : 0
                    };
                });
            } else {
                idols = defaultIdols.map(idol => ({ ...idol, votes: 0 }));
            }
            
            saveData();
            renderVotingGrid();
            renderLeaderboard();
        }

        function saveData() {
            localStorage.setItem('idolVoteData', JSON.stringify(idols));
            renderLeaderboard();
        }

        function vote(id) {
            const index = idols.findIndex(item => item.id === id);
            if (index !== -1) {
                idols[index].votes += 1;
                saveData();
                showToast(`Suara masuk untuk ${idols[index].name}`);
                
                // Haptic Feedback (Getar) jika support
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        function resetData() {
            if(confirm("PERINGATAN: Reset semua skor voting menjadi 0?")) {
                idols = defaultIdols.map(idol => ({ ...idol, votes: 0 }));
                saveData();
                renderVotingGrid();
                renderLeaderboard();
                showToast("Data telah direset.", true);
            }
        }

        function exportData() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Rank,Nama Idol,Total Suara\n";
            const sortedIdols = [...idols].sort((a, b) => b.votes - a.votes);
            sortedIdols.forEach((row, index) => {
                csvContent += `${index + 1},${row.name},${row.votes}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `hasil_voting_${Date.now()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast("Data diexport!");
        }

        // --- LONG PRESS LOGIC (1 Detik) ---
        function startPress(id) {
            if (isHolding) return;
            isHolding = true;

            const btn = document.getElementById(`btn-vote-${id}`);
            const progressBar = document.getElementById(`progress-${id}`);
            // Kita tidak mengubah text/icon lagi sesuai request

            // Visual Start
            if(btn) btn.classList.add('scale-95');
            
            // Progress Bar Animation (1 Detik)
            if(progressBar) {
                progressBar.style.transition = 'width 1s linear';
                progressBar.style.width = '100%';
            }

            pressTimer = setTimeout(() => {
                // Sukses tekan 1 detik
                vote(id);
                cancelPress(id, true); // Reset visual (true = sukses)
            }, 1000); // 1000ms = 1 detik
        }

        function cancelPress(id, isSuccess = false) {
            isHolding = false;
            clearTimeout(pressTimer);

            const btn = document.getElementById(`btn-vote-${id}`);
            const progressBar = document.getElementById(`progress-${id}`);

            // Visual Reset
            if (btn) btn.classList.remove('scale-95');
            
            // Reset Progress Bar Instantly
            if (progressBar) {
                progressBar.style.transition = 'none';
                progressBar.style.width = '0%';
            }
            
            // Tidak ada logic pengembalian teks karena teks tidak berubah
        }

        // --- UI RENDERING ---

        function renderVotingGrid() {
            const container = document.getElementById('idol-grid');
            container.innerHTML = '';
            
            idols.forEach(idol => {
                const card = document.createElement('div');
                // UPDATE: Menghapus hover:shadow-xl dan hover:-translate-y-1 dari Tailwind
                // Diganti dengan class manual 'card-hover' agar bisa diatur via media query
                card.className = "bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden flex flex-col group transition-all duration-300 transform card-hover";
                
                const placeholderUrl = `https://placehold.co/300x400/ec4899/white?text=${encodeURIComponent(idol.name)}`;
                
                card.innerHTML = `
                    <div class="relative aspect-[3/4] bg-gray-50 overflow-hidden no-select">
                        <!-- UPDATE: Menghapus group-hover:scale-105 diganti 'img-hover' -->
                        <img src="${idol.image}" 
                             alt="${idol.name}" 
                             class="w-full h-full object-cover transition-transform duration-700 pointer-events-none img-hover"
                             onerror="this.onerror=null; this.src='${placeholderUrl}';">
                        
                        <!-- UPDATE: Menghapus group-hover:opacity-100 diganti 'overlay-hover' -->
                        <div class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/50 to-transparent opacity-0 transition-opacity duration-300 overlay-hover"></div>
                    </div>

                    <div class="p-4 flex flex-col gap-3 flex-grow justify-between bg-white relative z-10">
                        <div class="text-center">
                            <h3 class="text-lg md:text-xl font-bold text-gray-800 leading-tight truncate select-none">${idol.name}</h3>
                        </div>

                        <button id="btn-vote-${idol.id}"
                                onmousedown="startPress(${idol.id})" 
                                onmouseup="cancelPress(${idol.id})" 
                                onmouseleave="cancelPress(${idol.id})"
                                ontouchstart="startPress(${idol.id})" 
                                ontouchend="cancelPress(${idol.id})"
                                oncontextmenu="return false;"
                                class="no-select relative w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white overflow-hidden font-bold py-3 px-4 rounded-xl shadow-md transition-all flex items-center justify-center gap-2 text-base tracking-wide active:scale-95">
                            
                            <!-- Progress Bar Background (Putih Transparan mengisi dari kiri) -->
                            <div id="progress-${idol.id}" class="absolute left-0 top-0 bottom-0 bg-white/80 w-0 h-full z-0 pointer-events-none"></div>

                            <!-- Text Content (On Top) dengan Shadow agar terbaca di background putih -->
                            <div class="relative z-10 flex items-center gap-2 pointer-events-none drop-shadow-md">
                                <i class="fa-solid fa-heart"></i>
                                <span>VOTE</span>
                            </div>
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Fungsi ini disederhanakan karena UI score sudah tidak ada di grid
        function updateVoteCountUI(id, newCount) {
           // Tidak melakukan apa-apa pada UI Grid, hanya placeholder logic
        }

        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            const totalVotesGlobal = idols.reduce((sum, item) => sum + item.votes, 0);
            const sortedIdols = [...idols].sort((a, b) => b.votes - a.votes);

            if (totalVotesGlobal === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="p-8 text-center text-gray-400 italic text-base">Belum ada suara masuk.</td></tr>`;
                return;
            }

            sortedIdols.forEach((idol, index) => {
                const percentage = totalVotesGlobal > 0 ? ((idol.votes / totalVotesGlobal) * 100).toFixed(1) : 0;
                let rankStyle = "text-gray-600 font-bold";
                let rowBg = "";
                let iconRank = "";

                if (index === 0) { 
                    rankStyle = "text-yellow-500 text-xl font-extrabold"; 
                    iconRank = '<i class="fa-solid fa-crown ml-2 text-yellow-400"></i>';
                    rowBg = "bg-yellow-50/50";
                } else if (index === 1) { 
                    rankStyle = "text-gray-400 text-lg font-bold";
                    rowBg = "bg-gray-50/50";
                } else if (index === 2) { 
                    rankStyle = "text-orange-400 text-lg font-bold";
                    rowBg = "bg-orange-50/50";
                }

                const tr = document.createElement('tr');
                tr.className = `border-b border-gray-100 hover:bg-gray-50 transition ${rowBg}`;
                tr.innerHTML = `
                    <td class="p-4 text-center ${rankStyle}">#${index + 1}</td>
                    <td class="p-4 font-medium text-gray-800 flex items-center gap-3">
                         <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden shrink-0 border border-gray-200 shadow-sm">
                            <img src="${idol.image}" class="w-full h-full object-cover" 
                                onerror="this.src='https://placehold.co/100x100?text=${idol.name.charAt(0)}'">
                         </div>
                        <span class="text-base md:text-lg">${idol.name}</span> ${iconRank}
                    </td>
                    <td class="p-4 text-right font-mono font-bold text-gray-700 text-lg">${idol.votes}</td>
                    <td class="p-4 text-right hidden sm:table-cell">
                        <div class="flex items-center justify-end gap-3">
                            <span class="text-sm text-gray-500 w-10">${percentage}%</span>
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-pink-500 to-purple-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- UTILITIES ---

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            const btnVoting = document.getElementById('btn-tab-voting');
            const btnAdmin = document.getElementById('btn-tab-admin');
            
            const inactiveClass = "text-gray-500 hover:text-gray-700 bg-transparent shadow-none";
            btnVoting.className = `px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 ${inactiveClass}`;
            btnAdmin.className = `px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 ${inactiveClass}`;

            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            const activeClass = "bg-white shadow text-pink-600";
            if(tabName === 'voting') {
                btnVoting.className = `px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 ${activeClass}`;
            } else {
                btnAdmin.className = `px-6 py-2 rounded-md text-sm font-semibold transition-all duration-200 ${activeClass}`;
                renderLeaderboard();
            }
        }

        function showToast(message, isWarning = false) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-message');
            toastMsg.innerText = message;
            const icon = toast.querySelector('i');
            icon.className = isWarning ? "fa-solid fa-triangle-exclamation text-yellow-400 text-2xl" : "fa-solid fa-check-circle text-green-400 text-2xl";
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => toast.classList.add('opacity-0', 'translate-y-10'), 2000);
        }

        document.addEventListener('DOMContentLoaded', initData);

    </script>
</body>
</html>
